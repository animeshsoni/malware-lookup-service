#!/bin/bash

# Script to run the web service in a python virtual environment.
# This script will install python3 and python3-venv, if not already installed.
# Web service will be hosted on localhost:5000 by default.

sudo apt-get -y install python3 python3-venv
if [ $? -ne 0 ]; then
    echo "Failed to install dependencies. Please resolve and try again."
fi

python3 -m venv .venv
if [ $? -ne 0 ]; then
    echo "Failed to create python virtual environment. Please resolve and try again."
fi

source .venv/bin/activate
if [ $? -ne 0 ]; then
    echo "Failed to activate python virtual environment. Please resolve and try again."
fi

pip install -r requirements.txt
if [ $? -ne 0 ]; then
    echo "Failed to install python requirements. Please resolve and try again."
fi

flask run
if [ $? -ne 0 ]; then
    echo "Failed to run flask app. Please resolve and try again."
fi

deactivate
if [ $? -ne 0 ]; then
    echo "Failed to deactivate python virtual environment."
fi

echo ""
echo "This script installed the dependencies: python3 python3-venv, if they were not already present."
echo "If you wish to remove these, please run the following command:"
echo "\"sudo apt -y remove python3 python3-venv\""
